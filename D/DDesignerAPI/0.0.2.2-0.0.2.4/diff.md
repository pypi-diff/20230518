# Comparing `tmp/DDesignerAPI-0.0.2.2-py3-none-any.whl.zip` & `tmp/DDesignerAPI-0.0.2.4-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,39 +1,31 @@
-Zip file size: 59862 bytes, number of entries: 37
--rw-rw-r--  2.0 unx      760 b- defN 23-May-03 05:10 _ddesigner_api/__init__.py
--rw-rw-r--  2.0 unx      871 b- defN 23-May-03 05:09 _ddesigner_api/pytorch/__init__.py
--rw-rw-r--  2.0 unx        0 b- defN 23-May-03 05:11 _ddesigner_api/pytorch/examples/__init__.py
--rw-rw-r--  2.0 unx     5016 b- defN 23-May-03 09:05 _ddesigner_api/pytorch/examples/examples_pytorch.py
--rw-rw-r--  2.0 unx      873 b- defN 23-Apr-25 00:24 _ddesigner_api/tensorflow/__init__.py
--rw-rw-r--  2.0 unx    11329 b- defN 23-Apr-25 00:24 _ddesigner_api/tensorflow/dpi_blocks.py
--rw-rw-r--  2.0 unx     6208 b- defN 23-Apr-25 00:24 _ddesigner_api/tensorflow/dpi_layers.py
--rw-rw-r--  2.0 unx        0 b- defN 23-Apr-25 00:24 _ddesigner_api/tensorflow/examples/__init__.py
--rw-rw-r--  2.0 unx     7883 b- defN 23-May-03 08:59 _ddesigner_api/tensorflow/examples/examples_keras.py
--rw-rw-r--  2.0 unx     3021 b- defN 23-May-03 09:00 _ddesigner_api/tensorflow/examples/examples_tensorflow.py
--rw-rw-r--  2.0 unx      790 b- defN 23-Apr-25 00:24 _ddesigner_api/tensorflow/xwn/__init__.py
--rw-rw-r--  2.0 unx    16322 b- defN 23-Apr-25 00:24 _ddesigner_api/tensorflow/xwn/base_conv.py
--rw-rw-r--  2.0 unx    29451 b- defN 23-Apr-25 00:24 _ddesigner_api/tensorflow/xwn/keras_layers.py
--rw-rw-r--  2.0 unx     4900 b- defN 23-May-03 06:47 _ddesigner_api/tensorflow/xwn/keras_opt.py
--rw-rw-r--  2.0 unx     9240 b- defN 23-Apr-25 00:24 _ddesigner_api/tensorflow/xwn/tf_nn.py
--rw-rw-r--  2.0 unx     3835 b- defN 23-Apr-25 00:24 _ddesigner_api/tensorflow/xwn/tf_opt.py
--rw-rw-r--  2.0 unx      964 b- defN 23-May-03 09:08 ddesigner_api/__init__.py
--rw-rw-r--  2.0 unx      871 b- defN 23-May-03 09:06 ddesigner_api/pytorch/__init__.py
--rw-rw-r--  2.0 unx        0 b- defN 23-May-03 09:06 ddesigner_api/pytorch/examples/__init__.py
--rw-rw-r--  2.0 unx     5016 b- defN 23-May-03 09:07 ddesigner_api/pytorch/examples/examples_pytorch.py
--rw-rw-r--  2.0 unx      873 b- defN 23-May-03 09:06 ddesigner_api/tensorflow/__init__.py
--rw-rw-r--  2.0 unx    11329 b- defN 23-May-03 09:06 ddesigner_api/tensorflow/dpi_blocks.py
--rw-rw-r--  2.0 unx     6208 b- defN 23-May-03 09:06 ddesigner_api/tensorflow/dpi_layers.py
--rw-rw-r--  2.0 unx        0 b- defN 23-May-03 09:06 ddesigner_api/tensorflow/examples/__init__.py
--rw-rw-r--  2.0 unx     7883 b- defN 23-May-03 09:07 ddesigner_api/tensorflow/examples/examples_keras.py
--rw-rw-r--  2.0 unx     3021 b- defN 23-May-03 09:07 ddesigner_api/tensorflow/examples/examples_tensorflow.py
--rw-rw-r--  2.0 unx      790 b- defN 23-May-03 09:06 ddesigner_api/tensorflow/xwn/__init__.py
--rw-rw-r--  2.0 unx    16322 b- defN 23-May-03 09:06 ddesigner_api/tensorflow/xwn/base_conv.py
--rw-rw-r--  2.0 unx    29451 b- defN 23-May-03 09:06 ddesigner_api/tensorflow/xwn/keras_layers.py
--rw-rw-r--  2.0 unx     5013 b- defN 23-May-03 11:25 ddesigner_api/tensorflow/xwn/keras_opt.py
--rw-rw-r--  2.0 unx     9240 b- defN 23-May-03 09:06 ddesigner_api/tensorflow/xwn/tf_nn.py
--rw-rw-r--  2.0 unx     4046 b- defN 23-May-03 09:06 ddesigner_api/tensorflow/xwn/tf_opt.py
--rwxrwxr-x  2.0 unx     9136 b- defN 23-May-03 12:05 DDesignerAPI-0.0.2.2.dist-info/LICENSE
--rw-rw-r--  2.0 unx     6002 b- defN 23-May-03 12:05 DDesignerAPI-0.0.2.2.dist-info/METADATA
--rw-rw-r--  2.0 unx       92 b- defN 23-May-03 12:05 DDesignerAPI-0.0.2.2.dist-info/WHEEL
--rw-rw-r--  2.0 unx       29 b- defN 23-May-03 12:05 DDesignerAPI-0.0.2.2.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     3557 b- defN 23-May-03 12:05 DDesignerAPI-0.0.2.2.dist-info/RECORD
-37 files, 220342 bytes uncompressed, 53988 bytes compressed:  75.5%
+Zip file size: 48291 bytes, number of entries: 29
+-rw-rw-r--  2.0 unx      962 b- defN 23-May-12 07:44 ddesigner_api/__init__.py
+-rw-rw-r--  2.0 unx      725 b- defN 23-May-12 07:44 ddesigner_api/numpy/__init__.py
+-rw-rw-r--  2.0 unx        0 b- defN 23-May-12 07:44 ddesigner_api/numpy/examples/__init__.py
+-rw-rw-r--  2.0 unx     2583 b- defN 23-May-12 07:44 ddesigner_api/numpy/examples/examples_numpy.py
+-rw-rw-r--  2.0 unx      738 b- defN 23-May-12 07:44 ddesigner_api/numpy/xwn/__init__.py
+-rw-rw-r--  2.0 unx     4852 b- defN 23-May-12 07:44 ddesigner_api/numpy/xwn/optimization.py
+-rw-rw-r--  2.0 unx      770 b- defN 23-May-12 07:44 ddesigner_api/pytorch/__init__.py
+-rw-rw-r--  2.0 unx        0 b- defN 23-May-12 07:44 ddesigner_api/pytorch/examples/__init__.py
+-rw-rw-r--  2.0 unx     5016 b- defN 23-May-12 07:44 ddesigner_api/pytorch/examples/examples_pytorch.py
+-rw-rw-r--  2.0 unx      736 b- defN 23-May-12 07:44 ddesigner_api/pytorch/xwn/__init__.py
+-rw-rw-r--  2.0 unx    63140 b- defN 23-May-12 07:44 ddesigner_api/pytorch/xwn/torch_nn.py
+-rw-rw-r--  2.0 unx     5030 b- defN 23-May-12 07:44 ddesigner_api/pytorch/xwn/torch_opt.py
+-rw-rw-r--  2.0 unx      873 b- defN 23-May-12 07:44 ddesigner_api/tensorflow/__init__.py
+-rw-rw-r--  2.0 unx    11329 b- defN 23-May-12 07:44 ddesigner_api/tensorflow/dpi_blocks.py
+-rw-rw-r--  2.0 unx     6208 b- defN 23-May-12 07:44 ddesigner_api/tensorflow/dpi_layers.py
+-rw-rw-r--  2.0 unx        0 b- defN 23-May-12 07:44 ddesigner_api/tensorflow/examples/__init__.py
+-rw-rw-r--  2.0 unx     7883 b- defN 23-May-12 07:44 ddesigner_api/tensorflow/examples/examples_keras.py
+-rw-rw-r--  2.0 unx     3021 b- defN 23-May-12 07:44 ddesigner_api/tensorflow/examples/examples_tensorflow.py
+-rw-rw-r--  2.0 unx      790 b- defN 23-May-12 07:44 ddesigner_api/tensorflow/xwn/__init__.py
+-rw-rw-r--  2.0 unx    16322 b- defN 23-May-12 07:44 ddesigner_api/tensorflow/xwn/base_conv.py
+-rw-rw-r--  2.0 unx    29451 b- defN 23-May-12 07:44 ddesigner_api/tensorflow/xwn/keras_layers.py
+-rw-rw-r--  2.0 unx     5013 b- defN 23-May-12 07:44 ddesigner_api/tensorflow/xwn/keras_opt.py
+-rw-rw-r--  2.0 unx     9240 b- defN 23-May-12 07:44 ddesigner_api/tensorflow/xwn/tf_nn.py
+-rw-rw-r--  2.0 unx     4046 b- defN 23-May-12 07:44 ddesigner_api/tensorflow/xwn/tf_opt.py
+-rwxrwxr-x  2.0 unx     9136 b- defN 23-May-12 07:54 DDesignerAPI-0.0.2.4.dist-info/LICENSE
+-rw-rw-r--  2.0 unx     6269 b- defN 23-May-12 07:54 DDesignerAPI-0.0.2.4.dist-info/METADATA
+-rw-rw-r--  2.0 unx       92 b- defN 23-May-12 07:54 DDesignerAPI-0.0.2.4.dist-info/WHEEL
+-rw-rw-r--  2.0 unx       14 b- defN 23-May-12 07:54 DDesignerAPI-0.0.2.4.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx     2735 b- defN 23-May-12 07:54 DDesignerAPI-0.0.2.4.dist-info/RECORD
+29 files, 196974 bytes uncompressed, 43761 bytes compressed:  77.8%
```

## zipnote {}

```diff
@@ -1,65 +1,41 @@
-Filename: _ddesigner_api/__init__.py
-Comment: 
-
-Filename: _ddesigner_api/pytorch/__init__.py
-Comment: 
-
-Filename: _ddesigner_api/pytorch/examples/__init__.py
-Comment: 
-
-Filename: _ddesigner_api/pytorch/examples/examples_pytorch.py
-Comment: 
-
-Filename: _ddesigner_api/tensorflow/__init__.py
-Comment: 
-
-Filename: _ddesigner_api/tensorflow/dpi_blocks.py
-Comment: 
-
-Filename: _ddesigner_api/tensorflow/dpi_layers.py
-Comment: 
-
-Filename: _ddesigner_api/tensorflow/examples/__init__.py
-Comment: 
-
-Filename: _ddesigner_api/tensorflow/examples/examples_keras.py
+Filename: ddesigner_api/__init__.py
 Comment: 
 
-Filename: _ddesigner_api/tensorflow/examples/examples_tensorflow.py
+Filename: ddesigner_api/numpy/__init__.py
 Comment: 
 
-Filename: _ddesigner_api/tensorflow/xwn/__init__.py
+Filename: ddesigner_api/numpy/examples/__init__.py
 Comment: 
 
-Filename: _ddesigner_api/tensorflow/xwn/base_conv.py
+Filename: ddesigner_api/numpy/examples/examples_numpy.py
 Comment: 
 
-Filename: _ddesigner_api/tensorflow/xwn/keras_layers.py
+Filename: ddesigner_api/numpy/xwn/__init__.py
 Comment: 
 
-Filename: _ddesigner_api/tensorflow/xwn/keras_opt.py
+Filename: ddesigner_api/numpy/xwn/optimization.py
 Comment: 
 
-Filename: _ddesigner_api/tensorflow/xwn/tf_nn.py
+Filename: ddesigner_api/pytorch/__init__.py
 Comment: 
 
-Filename: _ddesigner_api/tensorflow/xwn/tf_opt.py
+Filename: ddesigner_api/pytorch/examples/__init__.py
 Comment: 
 
-Filename: ddesigner_api/__init__.py
+Filename: ddesigner_api/pytorch/examples/examples_pytorch.py
 Comment: 
 
-Filename: ddesigner_api/pytorch/__init__.py
+Filename: ddesigner_api/pytorch/xwn/__init__.py
 Comment: 
 
-Filename: ddesigner_api/pytorch/examples/__init__.py
+Filename: ddesigner_api/pytorch/xwn/torch_nn.py
 Comment: 
 
-Filename: ddesigner_api/pytorch/examples/examples_pytorch.py
+Filename: ddesigner_api/pytorch/xwn/torch_opt.py
 Comment: 
 
 Filename: ddesigner_api/tensorflow/__init__.py
 Comment: 
 
 Filename: ddesigner_api/tensorflow/dpi_blocks.py
 Comment: 
@@ -90,23 +66,23 @@
 
 Filename: ddesigner_api/tensorflow/xwn/tf_nn.py
 Comment: 
 
 Filename: ddesigner_api/tensorflow/xwn/tf_opt.py
 Comment: 
 
-Filename: DDesignerAPI-0.0.2.2.dist-info/LICENSE
+Filename: DDesignerAPI-0.0.2.4.dist-info/LICENSE
 Comment: 
 
-Filename: DDesignerAPI-0.0.2.2.dist-info/METADATA
+Filename: DDesignerAPI-0.0.2.4.dist-info/METADATA
 Comment: 
 
-Filename: DDesignerAPI-0.0.2.2.dist-info/WHEEL
+Filename: DDesignerAPI-0.0.2.4.dist-info/WHEEL
 Comment: 
 
-Filename: DDesignerAPI-0.0.2.2.dist-info/top_level.txt
+Filename: DDesignerAPI-0.0.2.4.dist-info/top_level.txt
 Comment: 
 
-Filename: DDesignerAPI-0.0.2.2.dist-info/RECORD
+Filename: DDesignerAPI-0.0.2.4.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## ddesigner_api/__init__.py

```diff
@@ -13,14 +13,14 @@
 # limitations under the License.
 # ==============================================================================
 
 try:
     import tensorflow as tf
     from ddesigner_api import tensorflow
 except Exception as e:
-    print('*wranning: can not import tensorflow')
+    print('*wraning: can not import tensorflow')
 
 try:
     import torch
     from ddesigner_api import pytorch
 except Exception as e:
-    print('*wranning: can not import torch')
+    print('*wraning: can not import torch')
```

## ddesigner_api/pytorch/__init__.py

```diff
@@ -12,10 +12,7 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 # ==============================================================================
 
 
 from ddesigner_api.pytorch import xwn
 from ddesigner_api.pytorch import examples
-
-# from ddesigner_api.tensorflow import dpi_blocks
-# from ddesigner_api.tensorflow import dpi_layers
```

## ddesigner_api/tensorflow/xwn/keras_opt.py

```diff
@@ -21,15 +21,15 @@
 
 
 
 class Optimization:
     def __init__(
         self, 
         use_transform=False, 
-        bit=1, 
+        bit=4, 
         max_scale=4.0,
         use_pruning=False, 
         prun_weight=0.50,
         method='L1',
         transpose=False,
         ):
```

## ddesigner_api/tensorflow/xwn/tf_opt.py

```diff
@@ -18,15 +18,15 @@
 
 import tensorflow as tf
 
 
 
 def transform(
     x, 
-    bit=1, 
+    bit=4, 
     max_scale=4.0, 
     method='L1', 
     dtype='float32', 
     valid=False):
     '''
     x: (h,w,i,o)
     x_mag: (i,o)
```

## Comparing `_ddesigner_api/__init__.py` & `ddesigner_api/numpy/xwn/__init__.py`

 * *Files 9% similar despite different names*

```diff
@@ -10,9 +10,8 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 # ==============================================================================
 
 
-from ddesigner_api import tensorflow
-from ddesigner_api import pytorch
+from ddesigner_api.numpy.xwn import optimization
```

## Comparing `_ddesigner_api/pytorch/__init__.py` & `ddesigner_api/pytorch/xwn/__init__.py`

 * *Files 20% similar despite different names*

```diff
@@ -10,12 +10,8 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 # ==============================================================================
 
 
-from ddesigner_api.pytorch import xwn
-from ddesigner_api.pytorch import examples
-
-# from ddesigner_api.tensorflow import dpi_blocks
-# from ddesigner_api.tensorflow import dpi_layers
+from ddesigner_api.pytorch.xwn import torch_nn
```

## Comparing `_ddesigner_api/pytorch/examples/examples_pytorch.py` & `ddesigner_api/pytorch/xwn/torch_opt.py`

 * *Files 25% similar despite different names*

```diff
@@ -11,149 +11,146 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 # ==============================================================================
 
 import numpy as np
 import torch
-from ddesigner_api.pytorch.xwn import torch_nn as nn
 
 
 
-def fixed_input():
-    x_in = np.array([[                                                                            
-        [[2], [1], [2], [0], [1]],                                                                  
-        [[1], [3], [2], [2], [3]],                                                                  
-        [[1], [1], [3], [3], [0]],                                                                  
-        [[2], [2], [0], [1], [1]],
-        [[0], [0], [3], [1], [2]], ]])                                                              
-    kernel_in = np.array([                                                                        
-        [ [[2, 0.1]], [[3, 0.2]] ],                                                                  
-        [ [[0, 0.3]], [[1, 0.4]] ], ])                                                               
-    x = torch.from_numpy(np.transpose(x_in, (0,3,1,2)).astype('float32'))
-    kernel = torch.from_numpy(np.transpose(kernel_in, (3,2,0,1)).astype('float32'))
-    print('Input Shape = {}, Kernel Shape = {}'.format(x.shape, kernel.shape))
-    
-    print('====== torch.nn.Conv2d ======')
-    with torch.no_grad():
-        m = torch.nn.Conv2d(
-            in_channels=1, 
-            out_channels=2, 
-            kernel_size=2, 
-            stride=(1,1), 
-            padding='valid', 
-            bias=False
-        )
-        m.weight.copy_(kernel)
-        # o = torch.permute(m(x), (0,2,3,1))
-        o = m(x)
-        print(o)
-    print('==========================')
-    
-    print('====== dpi_nn.Conv2d (without opt) =====')
-    with torch.no_grad():
-        m = nn.Conv2d(
-            in_channels=1, 
-            out_channels=2, 
-            kernel_size=2, 
-            stride=(1,1), 
-            padding='valid', 
-            bias=False
-        )
-        m.weight.copy_(kernel)
-        o = m(x)
-        print(o)
-    print('==========================')
-    
-    print('====== dpi_nn.Conv2d (with opt) =====')
-    with torch.no_grad():
-        m = nn.Conv2d(
-            in_channels=1, 
-            out_channels=2, 
-            kernel_size=2, 
-            stride=(1,1), 
-            padding='valid', 
-            bias=False,
-            use_transform=True,
-            bit=4,
-            max_scale=4.0,
-        )
-        m.weight.copy_(kernel)
-        o = m(x)
-        print(o)
-    print('==========================')
-
-
-def random_input():
-    torch.manual_seed(87)
-    x = torch.randn(1,1,5,5)
-    kernel = torch.nn.init.xavier_uniform_(torch.empty(2,1,2,2))
-    print('Input Shape = {}, Kernel Shape = {}'.format((1,1,5,5), (2,1,2,2)))
-
-    print('====== torch.nn.Conv2d ======')
-    with torch.no_grad():
-        m = torch.nn.Conv2d(
-            in_channels=1, 
-            out_channels=2, 
-            kernel_size=2, 
-            stride=(1,1), 
-            padding='valid', 
-            bias=False
-        )
-        m.weight.copy_(kernel)
-        print(m(x))
-    print('==========================')
-
-    print('====== dpi_nn.Conv2d (without opt) =====')
-    with torch.no_grad():
-        m = nn.Conv2d(
-            in_channels=1, 
-            out_channels=2, 
-            kernel_size=2, 
-            stride=(1,1), 
-            padding='valid', 
-            bias=False
-        )
-        m.weight.copy_(kernel)
-        print(m(x))
-    print('==========================')
-
-    print('====== dpi_nn.Conv2d (with opt) =====')
-    with torch.no_grad():
-        m = nn.Conv2d(
-            in_channels=1, 
-            out_channels=2, 
-            kernel_size=2, 
-            stride=(1,1), 
-            padding='valid', 
-            bias=False,
-            use_transform=True,
-            bit=4,
-            max_scale=4.0,
-        )
-        m.weight.copy_(kernel)
-        print(m(x))
-    print('==========================')
-
-
-def main():
-    print('====== PYTORCH Examples======')
-
-    while True:
-        print('1: Fixed  Float32 Input Conv2D')
-        print('2: Random Float32 Input Conv2D')
-        print('q: Quit')
-        print('>>> Select Case:')
-        cmd = input()
-        if cmd == '1':
-            fixed_input()
-        elif cmd == '2':
-            random_input()
-        elif cmd == 'q': 
-            break
-        
-    return True
+class Optimization:
+    def __init__(
+        self, 
+        use_transform=False, 
+        bit=4, 
+        max_scale=4.0,
+        use_pruning=False, 
+        prun_weight=0.50,
+        method='L1',
+        transpose=False,
+        ):
+
+        self.bit = bit
+        self.use_transform = use_transform
+        self.use_pruning = use_pruning
+        self.prun_weight = prun_weight
+        self.method = method
+        self.transpose = transpose
+
+        self.dtype = torch.float32 
+        self.max_scale = torch.tensor(max_scale).type(self.dtype)
+        self.bit_scale = torch.tensor(bit - 1).type(self.dtype)
+        # self.num_scale = torch.tensor(np.power(2, self.bit_scale)).type(torch.int32)
+        self.num_scale = torch.pow(2, self.bit_scale).type(torch.int32)
+        self.map_scale = self._get_coeff()
+
+    def _get_coeff(self):
+        map_scale = []
+        for i in range(self.num_scale):
+            coeff = torch.pow(0.5, torch.tensor(i, dtype=self.dtype))
+            map_scale.append((self.max_scale * coeff)[..., None])
+
+        map_scale = torch.cat(map_scale, dim=-1)
+        return map_scale
+
+    def _transform(self, x):
+        '''
+        x: (h,w,i,o)
+        x_mag: (i,o)
+        method = 'L1' or 'L2' default=L1
+    
+        Map means metrics with extended dimension
+        '''
+        xdtype = x.dtype
+        # Check argument 
+        if self.bypass_transform:
+            return x
+            
+        x = x.type(self.dtype)
+        ones = torch.ones_like(x, dtype=self.dtype)
+        zeros = torch.zeros_like(x, dtype=self.dtype)
+    
+        # Map of sign - Plus=1, Minus=-1
+        x_sign = torch.where(x >= zeros, ones, -ones) # (h,w,i,o)
+    
+        # Magnitude
+        if self.method =='L2':
+            x_mag = torch.mean(torch.sqrt(torch.square(x)), dim=self.kernel_axis) # (i,o)
+        else:
+            x_mag = torch.mean(torch.abs(x), dim=self.kernel_axis) # (i,o)
+    
+        # Dummy scale
+        x_scale = torch.ones_like(x, dtype=torch.int32)
+    
+        # No Scale bit
+        if self.bit_scale < 1:
+            x_p = torch.where((x >= zeros), x_mag * ones, zeros) # (h,w,i,o)
+            x_n = torch.where((x < zeros), -x_mag * ones, zeros) # (h,w,i,o)
+            x = x_p + x_n
+
+        # Scale bit
+        else:
+            map_scale = self.map_scale[None, None, :] * x_mag[..., None] # (i,o,bb)
+
+            # Map of weight
+            map_diff = torch.abs(torch.abs(x)[..., None] - map_scale)
+            indices = torch.argmin(map_diff, dim=-1)[..., None]
+            map_x = torch.ones_like(map_diff, dtype=self.dtype) * map_scale
+            x = torch.gather(map_x, -1, indices)[..., 0] * x_sign
+
+        x = x.type(xdtype)
+        return x
+
+    def _pruning(self, x): 
+        """
+        Pruning optimization
+        x: (h,w,i,o)
+        o: (h,w,i,o) or (i,o)
+        """
+        if not self.use_pruning: 
+            return torch.ones_like(x, dtype=x.dtype)
+    
+        xdtype = x.dtype
+        x = x.type(self.dtype)
+        x_mag = torch.mean(torch.abs(x), dim=self.kernel_axis)
+        m_mag = torch.mean(x_mag, dim=0)[None, :]
+    
+        mask = torch.where(
+            torch.less(x_mag, m_mag * self.prun_weight), 
+            torch.zeros_like(x_mag, dtype=self.dtype), 
+            torch.ones_like(x_mag, dtype=self.dtype)
+        ) # (i,o)
+    
+        mask = mask.type(xdtype)
+        return mask
 
+    def optimize(self, x):
+        '''
+        x is AutoCastDistribuedVariable
+        '''
+        x = torch.permute(x, (2,3,1,0))
+        _x = torch.permute(x, self.transpose_axis)
+        x_tr = self._transform(_x)
+        x_mask = self._pruning(_x)
+        x_opt = x_tr * x_mask
+        x = torch.permute(x_opt, self.transpose_axis)
+        x = torch.permute(x, (3,2,0,1))
+        return x
+
+    def set_shape(self, shape):
+        self.shape = shape
+        self.bypass_transform = (self.bit < 1) or not self.use_transform
+        self.kernel_axis = list(range(len(shape) - 2))
+
+        if len(self.shape) == 4:
+            if self.transpose:
+                self.transpose_axis = (0,1,3,2)
+            else:
+                self.transpose_axis = (0,1,2,3)
+        elif len(self.shape) == 3:
+            if self.transpose:
+                self.transpose_axis = (0,2,1)
+            else:
+                self.transpose_axis = (0,1,2)
 
 
-if __name__ == '__main__':
-    main()
```

## Comparing `_ddesigner_api/tensorflow/__init__.py` & `ddesigner_api/numpy/__init__.py`

 * *Files 22% similar despite different names*

```diff
@@ -10,12 +10,8 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 # ==============================================================================
 
 
-from ddesigner_api.tensorflow import xwn
-from ddesigner_api.tensorflow import examples
-
-from ddesigner_api.tensorflow import dpi_blocks
-from ddesigner_api.tensorflow import dpi_layers
+from ddesigner_api.numpy import xwn
```

## Comparing `_ddesigner_api/tensorflow/xwn/keras_opt.py` & `ddesigner_api/numpy/xwn/optimization.py`

 * *Files 14% similar despite different names*

```diff
@@ -9,142 +9,141 @@
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 # ==============================================================================
 
-import os
-os.environ['TF_DETERMINISTIC_OPS'] = '0'
-
-import tensorflow as tf
-import tensorflow.compat.v1 as tf_v1
+import numpy as np
 
 
 
 class Optimization:
     def __init__(
         self, 
-        use_transform=False, 
-        bit=1, 
-        max_scale=4.0,
-        use_pruning=False, 
-        prun_weight=0.50,
-        method='L1',
-        transpose=False,
+        use_transform:bool=False, 
+        bit:int=4, 
+        max_scale:float=4.0,
+        use_pruning:bool=False, 
+        prun_weight:float=0.50,
+        method:str='L1',
+        transpose:bool=False,
+        shape:list=None,
         ):
 
         self.bit = bit
-        self.max_scale = max_scale
         self.use_transform = use_transform
         self.use_pruning = use_pruning
         self.prun_weight = prun_weight
         self.method = method
         self.transpose = transpose
 
-        self.dtype = 'float32'
-        self.bit_scale = tf.constant(bit - 1, dtype=self.dtype)
-        self.num_scale = tf.cast(tf.pow(2, self.bit_scale), tf.int64)
+        self.dtype = np.float32 
+        self.max_scale = float(max_scale)
+        self.bit_scale = int(bit - 1)
+        self.num_scale = np.power(2, self.bit_scale).astype(np.int32)
         self.map_scale = self._get_coeff()
-
+        if shape is not None:
+            self.set_shape(shape)
+            
     def _get_coeff(self):
         map_scale = []
         for i in range(self.num_scale):
-            coeff = tf.pow(0.5, tf.cast(i, self.dtype))
+            coeff = np.power(0.5, i)
             map_scale.append((self.max_scale * coeff)[..., None])
 
-        map_scale = tf.concat(map_scale, axis=-1)
+        map_scale = np.concatenate(map_scale, axis=-1)
         return map_scale
 
     def _transform(self, x):
         '''
         x: (h,w,i,o)
         x_mag: (i,o)
         method = 'L1' or 'L2' default=L1
     
         Map means metrics with extended dimension
         '''
+        xdtype = x.dtype
         # Check argument 
         if self.bypass_transform:
-            return tf.cast(x, self.dtype)
+            return x
             
-        x = tf.cast(x, self.dtype)
-        ones = tf.ones_like(x, dtype=self.dtype)
-        zeros = tf.zeros_like(x, dtype=x.dtype)
-        max_scale = tf.constant(self.max_scale, dtype=self.dtype)
+        x = x.astype(self.dtype)
+        ones = np.ones_like(x, dtype=self.dtype)
+        zeros = np.zeros_like(x, dtype=self.dtype)
     
         # Map of sign - Plus=1, Minus=-1
-        x_sign = tf.where(x >= zeros, ones, -ones) # (h,w,i,o)
+        x_sign = np.where(x >= zeros, ones, -ones) # (h,w,i,o)
     
         # Magnitude
         if self.method =='L2':
-            x_mag = tf.reduce_mean(tf.sqrt(tf.square(x)), axis=self.kernel_axis) # (i,o)
+            x_mag = np.mean(np.sqrt(np.square(x)), axis=self.kernel_axis) # (i,o)
         else:
-            x_mag = tf.reduce_mean(tf.abs(x), axis=self.kernel_axis) # (i,o)
+            x_mag = np.mean(np.abs(x), axis=self.kernel_axis) # (i,o)
     
         # Dummy scale
-        x_scale = tf.ones_like(x, dtype=tf.int64)
+        x_scale = np.ones_like(x, dtype=np.int32)
     
         # No Scale bit
         if self.bit_scale < 1:
-            x_p = tf.where((x >= zeros), x_mag * ones, zeros) # (h,w,i,o)
-            x_n = tf.where((x < zeros), -x_mag * ones, zeros) # (h,w,i,o)
+            x_p = np.where((x >= zeros), x_mag * ones, zeros) # (h,w,i,o)
+            x_n = np.where((x < zeros), -x_mag * ones, zeros) # (h,w,i,o)
             x = x_p + x_n
 
         # Scale bit
         else:
-            map_scale = self.map_scale * x_mag[..., None] # (i,o,bb)
+            map_scale = self.map_scale[None, None, :] * x_mag[..., None] # (i,o,bb)
 
             # Map of weight
-            map_diff = tf.abs(tf.abs(x)[..., None] - map_scale)
-            indices = tf.argmin(map_diff, axis=-1)
-            map_x = tf.ones_like(map_diff, dtype=self.dtype) * map_scale
-            x = tf.gather(map_x, indices, axis=-1, batch_dims=len(self.shape)) * x_sign
+            map_diff = np.abs(np.abs(x)[..., None] - map_scale)
+            indices = np.argmin(map_diff, axis=-1)[..., None]
+            map_x = np.ones_like(map_diff, dtype=self.dtype) * map_scale
+            x = np.take_along_axis(map_x, indices, axis=-1)[..., 0] * x_sign
 
+        x = x.astype(xdtype)
         return x
 
     def _pruning(self, x): 
         """
         Pruning optimization
         x: (h,w,i,o)
         o: (h,w,i,o) or (i,o)
         """
-        x = tf.cast(x, self.dtype)
-        x_mag = tf.reduce_mean(tf.abs(x), axis=self.kernel_axis)
-        m_mag = tf.reduce_mean(x_mag, axis=0)[None, :]
-    
         if not self.use_pruning: 
-            return tf.ones_like(x, dtype=self.dtype)
+            return np.ones_like(x, dtype=x.dtype)
     
-        mask = tf.where(
-            tf.less(x_mag, m_mag * self.prun_weight), 
-            tf.zeros_like(x_mag, dtype=self.dtype), 
-            tf.ones_like(x_mag, dtype=self.dtype)
+        xdtype = x.dtype
+        x = x.astype(self.dtype)
+        x_mag = np.mean(np.abs(x), axis=self.kernel_axis)
+        m_mag = np.mean(x_mag, axis=0)[None, :]
+    
+        mask = np.where(
+            np.less(x_mag, m_mag * self.prun_weight), 
+            np.zeros_like(x_mag, dtype=self.dtype), 
+            np.ones_like(x_mag, dtype=self.dtype)
         ) # (i,o)
     
+        mask = mask.astype(xdtype)
         return mask
 
     def optimize(self, x):
         '''
         x is AutoCastDistribuedVariable
         '''
-        _x = tf.transpose(x, self.transpose_axis)
-        x_tr = self._transform(_x)
-        x_mask = self._pruning(_x)
+        x = np.transpose(x, self.transpose_axis)
+        x_tr = self._transform(x)
+        x_mask = self._pruning(x)
         x_opt = x_tr * x_mask
-        _x = tf.transpose(x_opt, self.transpose_axis)
-        print(x.dtype, _x.dtype)
-        x = tf_v1.assign(x, _x)
-
+        x = np.transpose(x_opt, self.transpose_axis)
         return x
 
     def set_shape(self, shape):
         self.shape = shape
         self.bypass_transform = (self.bit < 1) or not self.use_transform
-        self.kernel_axis = list(range(len(shape) - 2))
+        self.kernel_axis = tuple(range(len(shape) - 2))
 
         if len(self.shape) == 4:
             if self.transpose:
                 self.transpose_axis = (0,1,3,2)
             else:
                 self.transpose_axis = (0,1,2,3)
         elif len(self.shape) == 3:
```

## Comparing `DDesignerAPI-0.0.2.2.dist-info/LICENSE` & `DDesignerAPI-0.0.2.4.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `DDesignerAPI-0.0.2.2.dist-info/METADATA` & `DDesignerAPI-0.0.2.4.dist-info/METADATA`

 * *Files 4% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: DDesignerAPI
-Version: 0.0.2.2
+Version: 0.0.2.4
 Summary: Deep-learning Designer: Deep-Learning Training Optimization & Layers API(like Keras)
 Home-page: https://github.com/DPI/TrainingAPI
 Author: Deeper-I
 Author-email: dean@deeper-i.com
 License: Apache-2.0
 Keywords: deeper-i,xwn,tensorflow,keras
 Platform: UNKNOWN
@@ -171,16 +171,25 @@
         >>> 2: Random Float32 Input Conv2D
         >>> 3: Random Float32 Input Conv2DTranspose
         >>> 4: Random Float16 Input Conv2D
         >>> q: Quit
         >>> Select Case: ...
 
 ### 3.3.3. PyTorch
-        >>> import ddesigner_api.pythorch.examples.examples_pytorch as ex
+        >>> import ddesigner_api.pytorch.examples.examples_pytorch as ex
         >>> ex.main()
         >>> ====== PYTORCH Examples======
         >>> 1: Fixed  Float32 Input Conv2D
         >>> 2: Random Float32 Input Conv2D
         >>> q: Quit
         >>> Select Case: ...
 
+### 3.3.4. Numpy
+        >>> import ddesigner_api.numpy.examples.examples_numpy as ex
+        >>> ex.main()
+        >>> ====== NUMPY Examples======
+        >>> 1: XWN Transform
+        >>> 2: XWN Transform and Pruning
+        >>> q: Quit
+        >>> Select Case: ...
+
```

