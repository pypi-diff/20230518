# Comparing `tmp/azureml_rag-0.1.3-py3-none-any.whl.zip` & `tmp/azureml_rag-0.1.4-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,59 +1,59 @@
-Zip file size: 166101 bytes, number of entries: 57
--rw-rw-rw-  2.0 fat      246 b- defN 23-May-16 21:28 azureml/rag/__init__.py
--rw-rw-rw-  2.0 fat    39995 b- defN 23-May-16 21:28 azureml/rag/documents.py
--rw-rw-rw-  2.0 fat    27598 b- defN 23-May-16 21:28 azureml/rag/embeddings.py
--rw-rw-rw-  2.0 fat     5058 b- defN 23-May-16 21:28 azureml/rag/mlindex.py
--rw-rw-rw-  2.0 fat     4149 b- defN 23-May-16 21:28 azureml/rag/models.py
--rw-rw-rw-  2.0 fat     4646 b- defN 23-May-16 21:29 azureml/rag/_asset_client/client.py
--rw-rw-rw-  2.0 fat      893 b- defN 23-May-16 21:30 azureml/rag/_asset_client/_restclient/__init__.py
--rw-rw-rw-  2.0 fat     4381 b- defN 23-May-16 21:30 azureml/rag/_asset_client/_restclient/_azure_machine_learning_workspaces.py
--rw-rw-rw-  2.0 fat     3538 b- defN 23-May-16 21:30 azureml/rag/_asset_client/_restclient/_configuration.py
--rw-rw-rw-  2.0 fat     1561 b- defN 23-May-16 21:30 azureml/rag/_asset_client/_restclient/_patch.py
--rw-rw-rw-  2.0 fat      495 b- defN 23-May-16 21:30 azureml/rag/_asset_client/_restclient/_version.py
--rw-rw-rw-  2.0 fat      399 b- defN 23-May-16 21:30 azureml/rag/_asset_client/_restclient/models.py
--rw-rw-rw-  2.0 fat      957 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/dataset/__init__.py
--rw-rw-rw-  2.0 fat     3802 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/dataset/_azure_machine_learning_workspaces.py
--rw-rw-rw-  2.0 fat     3144 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/dataset/_configuration.py
--rw-rw-rw-  2.0 fat      694 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/dataset/_patch.py
--rw-rw-rw-  2.0 fat    81019 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/dataset/_serialization.py
--rw-rw-rw-  2.0 fat     1833 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/dataset/_vendor.py
--rw-rw-rw-  2.0 fat      495 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/dataset/_version.py
--rw-rw-rw-  2.0 fat     6787 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/dataset/models/__init__.py
--rw-rw-rw-  2.0 fat     4635 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/dataset/models/_azure_machine_learning_workspaces_enums.py
--rw-rw-rw-  2.0 fat   131448 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/dataset/models/_models_py3.py
--rw-rw-rw-  2.0 fat      694 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/dataset/models/_patch.py
--rw-rw-rw-  2.0 fat      585 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/dataset/operations/__init__.py
--rw-rw-rw-  2.0 fat   104636 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/dataset/operations/_data_version_operations.py
--rw-rw-rw-  2.0 fat    80785 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/dataset/operations/_mlindex_operations.py
--rw-rw-rw-  2.0 fat      893 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/runhistory/__init__.py
--rw-rw-rw-  2.0 fat     3902 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/runhistory/_azure_machine_learning_workspaces.py
--rw-rw-rw-  2.0 fat     3226 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/runhistory/_configuration.py
--rw-rw-rw-  2.0 fat     1561 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/runhistory/_patch.py
--rw-rw-rw-  2.0 fat     1255 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/runhistory/_vendor.py
--rw-rw-rw-  2.0 fat      495 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/runhistory/_version.py
--rw-rw-rw-  2.0 fat    11705 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/runhistory/models/__init__.py
--rw-rw-rw-  2.0 fat     2566 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/runhistory/models/_azure_machine_learning_workspaces_enums.py
--rw-rw-rw-  2.0 fat   175170 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/runhistory/models/_models.py
--rw-rw-rw-  2.0 fat   188776 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/runhistory/models/_models_py3.py
--rw-rw-rw-  2.0 fat      563 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/runhistory/operations/__init__.py
--rw-rw-rw-  2.0 fat   162796 b- defN 23-May-16 21:31 azureml/rag/_asset_client/_restclient/runhistory/operations/_runs_operations.py
--rw-rw-rw-  2.0 fat    10785 b- defN 23-May-16 21:29 azureml/rag/langchain/acs.py
--rw-rw-rw-  2.0 fat      183 b- defN 23-May-16 21:29 azureml/rag/tasks/__init__.py
--rw-rw-rw-  2.0 fat     2094 b- defN 23-May-16 21:29 azureml/rag/tasks/build_faiss.py
--rw-rw-rw-  2.0 fat     7191 b- defN 23-May-16 21:29 azureml/rag/tasks/crack_and_chunk.py
--rw-rw-rw-  2.0 fat     7330 b- defN 23-May-16 21:29 azureml/rag/tasks/embed.py
--rw-rw-rw-  2.0 fat     5410 b- defN 23-May-16 21:29 azureml/rag/tasks/embed_prs.py
--rw-rw-rw-  2.0 fat     2194 b- defN 23-May-16 21:29 azureml/rag/tasks/git_clone.py
--rw-rw-rw-  2.0 fat     2791 b- defN 23-May-16 21:29 azureml/rag/tasks/register_mlindex.py
--rw-rw-rw-  2.0 fat    17073 b- defN 23-May-16 21:29 azureml/rag/tasks/update_acs.py
--rw-rw-rw-  2.0 fat      208 b- defN 23-May-16 21:29 azureml/rag/utils/__init__.py
--rw-rw-rw-  2.0 fat     1588 b- defN 23-May-16 21:29 azureml/rag/utils/azureml.py
--rw-rw-rw-  2.0 fat     7435 b- defN 23-May-16 21:29 azureml/rag/utils/connections.py
--rw-rw-rw-  2.0 fat     2350 b- defN 23-May-16 21:29 azureml/rag/utils/git.py
--rw-rw-rw-  2.0 fat     2330 b- defN 23-May-16 21:29 azureml/rag/utils/logging.py
--rw-rw-rw-  2.0 fat     1021 b- defN 23-May-16 21:36 azureml_rag-0.1.3.dist-info/LICENSE.txt
--rw-rw-rw-  2.0 fat     3482 b- defN 23-May-16 21:36 azureml_rag-0.1.3.dist-info/METADATA
--rw-rw-rw-  2.0 fat       97 b- defN 23-May-16 21:36 azureml_rag-0.1.3.dist-info/WHEEL
--rw-rw-rw-  2.0 fat        8 b- defN 23-May-16 21:36 azureml_rag-0.1.3.dist-info/top_level.txt
-?rw-rw-r--  2.0 fat     6063 b- defN 23-May-16 21:36 azureml_rag-0.1.3.dist-info/RECORD
-57 files, 1147014 bytes uncompressed, 156007 bytes compressed:  86.4%
+Zip file size: 166769 bytes, number of entries: 57
+-rw-rw-rw-  2.0 fat      246 b- defN 23-May-18 00:06 azureml/rag/__init__.py
+-rw-rw-rw-  2.0 fat    39993 b- defN 23-May-18 00:06 azureml/rag/documents.py
+-rw-rw-rw-  2.0 fat    27596 b- defN 23-May-18 00:06 azureml/rag/embeddings.py
+-rw-rw-rw-  2.0 fat     5058 b- defN 23-May-18 00:06 azureml/rag/mlindex.py
+-rw-rw-rw-  2.0 fat     4149 b- defN 23-May-18 00:06 azureml/rag/models.py
+-rw-rw-rw-  2.0 fat     4646 b- defN 23-May-18 00:07 azureml/rag/_asset_client/client.py
+-rw-rw-rw-  2.0 fat      893 b- defN 23-May-18 00:08 azureml/rag/_asset_client/_restclient/__init__.py
+-rw-rw-rw-  2.0 fat     4381 b- defN 23-May-18 00:08 azureml/rag/_asset_client/_restclient/_azure_machine_learning_workspaces.py
+-rw-rw-rw-  2.0 fat     3538 b- defN 23-May-18 00:08 azureml/rag/_asset_client/_restclient/_configuration.py
+-rw-rw-rw-  2.0 fat     1561 b- defN 23-May-18 00:08 azureml/rag/_asset_client/_restclient/_patch.py
+-rw-rw-rw-  2.0 fat      495 b- defN 23-May-18 00:08 azureml/rag/_asset_client/_restclient/_version.py
+-rw-rw-rw-  2.0 fat      399 b- defN 23-May-18 00:08 azureml/rag/_asset_client/_restclient/models.py
+-rw-rw-rw-  2.0 fat      957 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/dataset/__init__.py
+-rw-rw-rw-  2.0 fat     3802 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/dataset/_azure_machine_learning_workspaces.py
+-rw-rw-rw-  2.0 fat     3144 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/dataset/_configuration.py
+-rw-rw-rw-  2.0 fat      694 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/dataset/_patch.py
+-rw-rw-rw-  2.0 fat    81019 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/dataset/_serialization.py
+-rw-rw-rw-  2.0 fat     1833 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/dataset/_vendor.py
+-rw-rw-rw-  2.0 fat      495 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/dataset/_version.py
+-rw-rw-rw-  2.0 fat     6787 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/dataset/models/__init__.py
+-rw-rw-rw-  2.0 fat     4635 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/dataset/models/_azure_machine_learning_workspaces_enums.py
+-rw-rw-rw-  2.0 fat   131448 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/dataset/models/_models_py3.py
+-rw-rw-rw-  2.0 fat      694 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/dataset/models/_patch.py
+-rw-rw-rw-  2.0 fat      585 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/dataset/operations/__init__.py
+-rw-rw-rw-  2.0 fat   104636 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/dataset/operations/_data_version_operations.py
+-rw-rw-rw-  2.0 fat    80785 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/dataset/operations/_mlindex_operations.py
+-rw-rw-rw-  2.0 fat      893 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/runhistory/__init__.py
+-rw-rw-rw-  2.0 fat     3902 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/runhistory/_azure_machine_learning_workspaces.py
+-rw-rw-rw-  2.0 fat     3226 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/runhistory/_configuration.py
+-rw-rw-rw-  2.0 fat     1561 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/runhistory/_patch.py
+-rw-rw-rw-  2.0 fat     1255 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/runhistory/_vendor.py
+-rw-rw-rw-  2.0 fat      495 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/runhistory/_version.py
+-rw-rw-rw-  2.0 fat    11705 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/runhistory/models/__init__.py
+-rw-rw-rw-  2.0 fat     2566 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/runhistory/models/_azure_machine_learning_workspaces_enums.py
+-rw-rw-rw-  2.0 fat   175170 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/runhistory/models/_models.py
+-rw-rw-rw-  2.0 fat   188776 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/runhistory/models/_models_py3.py
+-rw-rw-rw-  2.0 fat      563 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/runhistory/operations/__init__.py
+-rw-rw-rw-  2.0 fat   162796 b- defN 23-May-18 00:09 azureml/rag/_asset_client/_restclient/runhistory/operations/_runs_operations.py
+-rw-rw-rw-  2.0 fat    10785 b- defN 23-May-18 00:07 azureml/rag/langchain/acs.py
+-rw-rw-rw-  2.0 fat      183 b- defN 23-May-18 00:07 azureml/rag/tasks/__init__.py
+-rw-rw-rw-  2.0 fat     2094 b- defN 23-May-18 00:07 azureml/rag/tasks/build_faiss.py
+-rw-rw-rw-  2.0 fat     7190 b- defN 23-May-18 00:07 azureml/rag/tasks/crack_and_chunk.py
+-rw-rw-rw-  2.0 fat     7330 b- defN 23-May-18 00:07 azureml/rag/tasks/embed.py
+-rw-rw-rw-  2.0 fat     5410 b- defN 23-May-18 00:07 azureml/rag/tasks/embed_prs.py
+-rw-rw-rw-  2.0 fat     2194 b- defN 23-May-18 00:07 azureml/rag/tasks/git_clone.py
+-rw-rw-rw-  2.0 fat     2791 b- defN 23-May-18 00:07 azureml/rag/tasks/register_mlindex.py
+-rw-rw-rw-  2.0 fat    17977 b- defN 23-May-18 00:07 azureml/rag/tasks/update_acs.py
+-rw-rw-rw-  2.0 fat      208 b- defN 23-May-18 00:07 azureml/rag/utils/__init__.py
+-rw-rw-rw-  2.0 fat     1588 b- defN 23-May-18 00:07 azureml/rag/utils/azureml.py
+-rw-rw-rw-  2.0 fat     7435 b- defN 23-May-18 00:07 azureml/rag/utils/connections.py
+-rw-rw-rw-  2.0 fat     2350 b- defN 23-May-18 00:07 azureml/rag/utils/git.py
+-rw-rw-rw-  2.0 fat     2330 b- defN 23-May-18 00:07 azureml/rag/utils/logging.py
+-rw-rw-rw-  2.0 fat     1021 b- defN 23-May-18 00:13 azureml_rag-0.1.4.dist-info/LICENSE.txt
+-rw-rw-rw-  2.0 fat     4968 b- defN 23-May-18 00:13 azureml_rag-0.1.4.dist-info/METADATA
+-rw-rw-rw-  2.0 fat       97 b- defN 23-May-18 00:13 azureml_rag-0.1.4.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat        8 b- defN 23-May-18 00:13 azureml_rag-0.1.4.dist-info/top_level.txt
+?rw-rw-r--  2.0 fat     6063 b- defN 23-May-18 00:13 azureml_rag-0.1.4.dist-info/RECORD
+57 files, 1149399 bytes uncompressed, 156675 bytes compressed:  86.4%
```

## zipnote {}

```diff
@@ -150,23 +150,23 @@
 
 Filename: azureml/rag/utils/git.py
 Comment: 
 
 Filename: azureml/rag/utils/logging.py
 Comment: 
 
-Filename: azureml_rag-0.1.3.dist-info/LICENSE.txt
+Filename: azureml_rag-0.1.4.dist-info/LICENSE.txt
 Comment: 
 
-Filename: azureml_rag-0.1.3.dist-info/METADATA
+Filename: azureml_rag-0.1.4.dist-info/METADATA
 Comment: 
 
-Filename: azureml_rag-0.1.3.dist-info/WHEEL
+Filename: azureml_rag-0.1.4.dist-info/WHEEL
 Comment: 
 
-Filename: azureml_rag-0.1.3.dist-info/top_level.txt
+Filename: azureml_rag-0.1.4.dist-info/top_level.txt
 Comment: 
 
-Filename: azureml_rag-0.1.3.dist-info/RECORD
+Filename: azureml_rag-0.1.4.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## azureml/rag/documents.py

```diff
@@ -281,15 +281,15 @@
     """Get a text splitter for a given file extension."""
     use_nltk = False
     if "use_nltk" in arguments:
         use_nltk = arguments['use_nltk'] is True
         del arguments["use_nltk"]
     use_rcts = False
     if "use_rcts" in arguments:
-        use_nltk = arguments['use_rcts'] is True
+        use_rcts = arguments['use_rcts'] is True
         del arguments['use_rcts']
 
     # Handle non-natural language splitters
     if file_extension == ".py":
         from langchain.text_splitter import PythonCodeTextSplitter
         return PythonCodeTextSplitter.from_tiktoken_encoder(**arguments)
 
@@ -754,15 +754,15 @@
 
 def files_to_document_source(
         files_source: Union[str, Path],
         glob: str = '**/*',
         base_url: Optional[str] = None,
         process_url: Optional[Callable[[str], str]] = None) -> Iterator[DocumentSource]:
     """Convert files to DocumentSource."""
-    for file in Path(files_source).rglob(glob):
+    for file in Path(files_source).glob(glob):
         if not file.is_file():
             continue
         relative_path = file.relative_to(files_source)
         url = str(relative_path)
         if base_url:
             url = f'{base_url}/{relative_path}'
         if process_url:
@@ -836,15 +836,15 @@
         summary_model_config: Optional[dict] = None) -> Iterator[List[StaticDocument]]:
     """Iterate over files in a directory and yield chunks of documents."""
     import time
 
     # fs, uri = url_to_fs(files_source)
     # files = fs.glob(f'{uri}/{glob}')
 
-    files = (f for f in Path(files_source).rglob(glob) if f.is_file())
+    files = (f for f in Path(files_source).glob(glob) if f.is_file())
 
     # Filter file list to only those in allowed_extensions, if provided, print files that are filtered out
     if allowed_extensions is not None:
         def filter_extensions(files):
             total_files = 0
             skipped_files = 0
             skipped_extensions = {}
```

## azureml/rag/embeddings.py

```diff
@@ -587,15 +587,15 @@
             documents_embedded[doc_id] = \
                 DataEmbeddedDocument(doc_id, mtime, document_hash,
                                      document_data, embeddings, document_metadata)
 
         return documents_embedded
 
     def as_faiss_index(self):
-        """Returns a FAISS index that can be used to query the embeddings."""""
+        """Returns a FAISS index that can be used to query the embeddings."""
         from langchain.docstore.in_memory import InMemoryDocstore
         from langchain.vectorstores import FAISS
         from langchain.vectorstores.faiss import dependable_faiss_import
         import numpy as np
 
         logger.info("Building index", extra={'print': True})
         t1 = time.time()
```

## azureml/rag/langchain/acs.py

```diff
@@ -77,15 +77,15 @@
     @classmethod
     def from_mlindex(cls, uri: str):
         """Create a vector store from a MLIndex uri."""
         from ..mlindex import MLIndex
         mlindex = MLIndex(uri)
         return mlindex.as_langchain_vectorstore()
 
-    def similarity_search(self, query: str, k: int = 4, **kwargs: Any) -> List[Document]:
+    def similarity_search(self, query: str, k: int = 8, **kwargs: Any) -> List[Document]:
         """Search for similar documents by query."""
         return [item[0] for item in self._similarity_search_with_relevance_scores(query, k, **kwargs)]
 
     def _similarity_search_with_relevance_scores(self, query: str, k: int = 4, **kwargs: Any) -> List[Tuple[Document, float]]:
         """Search for similar documents by query."""
         embedded_query = self.embeddings.embed_query(query)
         return self._similarity_search_by_vector_with_relevance_scores(query, embedded_query, k, **kwargs)
```

## azureml/rag/tasks/crack_and_chunk.py

```diff
@@ -53,15 +53,15 @@
     parser.add_argument("--data_source_url", type=str, required=False)
     parser.add_argument("--document_path_replacement_regex", type=str, required=False)
     parser.add_argument("--max_sample_files", type=int, default=-1)
     parser.add_argument("--include_summary", type=str, default="False")
     parser.add_argument("--summary_model_config", type=str, default='{"type": "azure_open_ai", "model_name": "gpt-35-turbo", "deployment_name": "gpt-35-turbo"}')
     parser.add_argument("--openai_api_version", type=str, default='2023-03-15-preview')
     parser.add_argument("--openai_api_type", type=str, default=None)
-    parser.add_argument("--use_rcts", type=bool, default=False)
+    parser.add_argument("--use_rcts", type=bool, default=True)
 
     args = parser.parse_args()
     print('\n'.join(f'{k}={v}' for k, v in vars(args).items()))
 
     enable_stdout_logging()
 
     # Get all files in directory, recursively
```

## azureml/rag/tasks/update_acs.py

```diff
@@ -220,32 +220,33 @@
     batch_size = acs_config['batch_size'] if 'batch_size' in acs_config else 100
 
     def process_upload_results(results):
         succeeded = []
         failed = []
         for r in results:
             if isinstance(r, dict):
-                if r['status'] == False:
+                if r['status'] is False:
                     failed.append(r)
                 else:
                     succeeded.append(r)
             else:
                 if r.succeeded:
                     succeeded.append(r)
                 else:
                     failed.append(r)
         logger.info(f"Uploaded {len(succeeded)} documents to ACS in {time.time() - start_time:.4f} seconds, {len(failed)} failed", extra={'print': True})
         if len(failed) > 0:
-            for r in results:
+            for r in failed:
                 if isinstance(r, dict):
-                    error = r['error_message']
+                    error = r['errorMessage']
                 else:
                     error = r.error_message
                 logger.error(f"Failed document reason: {error}", extra={'print': True})
-            raise RuntimeError(f"Failed to upload {len(failed)} documents.")
+            return failed
+        return []
 
     t1 = time.time()
     num_source_docs = 0
     batch = []
     for doc_id, emb_doc in emb._document_embeddings.items():
         logger.info(f'Adding document: {doc_id}', extra={'print': True})
         acs_doc = {
@@ -264,23 +265,37 @@
             acs_doc[f"content_vector_{emb.kind}"] = emb_doc.get_embeddings()
 
         batch.append(acs_doc)
         if len(batch) % batch_size == 0:
             logger.info(f"Sending {len(batch)} documents to ACS", extra={'print': True})
             start_time = time.time()
             results = upload_docs_batch(batch)
-            process_upload_results(results)
+            failed = process_upload_results(results)
+            if len(failed) > 0:
+                logger.info(f"Retrying {len(failed)} documents", extra={'print': True})
+                failed_ids = [fail['key'] for fail in failed]
+                results = upload_docs_batch([doc for doc in batch if doc['id'] in failed_ids])
+                failed = process_upload_results(results)
+                if len(failed) > 0:
+                    raise RuntimeError(f"Failed to upload {len(failed)} documents.")
             batch = []
             num_source_docs += batch_size
 
     if len(batch) > 0:
         logger.info(f"Sending {len(batch)} documents to ACS", extra={'print': True})
         start_time = time.time()
         results = upload_docs_batch(batch)
-        process_upload_results(results)
+        failed = process_upload_results(results)
+        if len(failed) > 0:
+                logger.info(f"Retrying {len(failed)} documents", extra={'print': True})
+                failed_ids = [fail['key'] for fail in failed]
+                results = upload_docs_batch([doc for doc in batch if doc['id'] in failed_ids])
+                failed = process_upload_results(results)
+                if len(failed) > 0:
+                    raise RuntimeError(f"Failed to upload {len(failed)} documents.")
 
         num_source_docs += len(batch)
 
     logger.info(f"Built index from {num_source_docs} documents and {len(emb._document_embeddings)} chunks, took {time.time()-t1:.4f} seconds", extra={'print': True})
 
     if output_path is not None:
         logger.info('Writing MLIndex yaml', extra={'print': True})
```

## Comparing `azureml_rag-0.1.3.dist-info/LICENSE.txt` & `azureml_rag-0.1.4.dist-info/LICENSE.txt`

 * *Files identical despite different names*

## Comparing `azureml_rag-0.1.3.dist-info/RECORD` & `azureml_rag-0.1.4.dist-info/RECORD`

 * *Files 3% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 azureml/rag/__init__.py,sha256=zgRl-az58He0no_ZUWab0AuVQSOTmgCLlfwbEcnwKS0,246
-azureml/rag/documents.py,sha256=5lhL6lxXhTa1wlmyLhaz7Ob-ePqzC8lYpaYF50Kqi-M,39995
-azureml/rag/embeddings.py,sha256=XAFRu19tq_F8bixWFGXzwS5nnzAJx6XLP_Zr9hS33mk,27598
+azureml/rag/documents.py,sha256=QgTx5P8xtBRb4OgplPlx_sB2_f3ObfeVCvqs76A18ZE,39993
+azureml/rag/embeddings.py,sha256=aadXgbZtYhmIkx69sMIEyPmNk0F5o4giM5ZBYC4fjKA,27596
 azureml/rag/mlindex.py,sha256=DNb-Z15nTzjmGZH5h0RGjqxQRvnIDg756W8gJDbObhA,5058
 azureml/rag/models.py,sha256=Ga9tvV0FsVhXprEeWpPVakNJ9q96byc0OjDESqkMuCw,4149
 azureml/rag/_asset_client/client.py,sha256=LpsDsedlQRxytezdvnxx1zfEQUb9DcYDY6RfkRSlXT0,4646
 azureml/rag/_asset_client/_restclient/__init__.py,sha256=38lKUIqL59KqhES7ZGBUGcrELWICWet0VFLxwY4W0fo,893
 azureml/rag/_asset_client/_restclient/_azure_machine_learning_workspaces.py,sha256=7XqTcSuvXHcKXu4FE71E4rBQAQ4Fmpdq8SXrhU7_AAg,4381
 azureml/rag/_asset_client/_restclient/_configuration.py,sha256=E52K3BmA4ZqAE6oP5VjRK32HsBrl6W9Y1oOsWCJu8Ig,3538
 azureml/rag/_asset_client/_restclient/_patch.py,sha256=wuqrJGWK488sJvWwSq6iwPTqil7TPaRadoxE7BMK0tA,1561
@@ -32,26 +32,26 @@
 azureml/rag/_asset_client/_restclient/runhistory/_version.py,sha256=72yoX3gRVc4OFrnlCjEq_1cS0FLSIvofYIXtMN1ElvI,495
 azureml/rag/_asset_client/_restclient/runhistory/models/__init__.py,sha256=RSjYy-jYXXp31fA5tEprD1uPTdaoCJsE4IKfDBlg8a0,11705
 azureml/rag/_asset_client/_restclient/runhistory/models/_azure_machine_learning_workspaces_enums.py,sha256=cyvWolLt_kCOalE8BvtnI_msfmAAlTYzdob0QDp1KZ0,2566
 azureml/rag/_asset_client/_restclient/runhistory/models/_models.py,sha256=CqQccTVrcm5_9uBZOJ6AMubF9K8GphuIzmF1j46G84Q,175170
 azureml/rag/_asset_client/_restclient/runhistory/models/_models_py3.py,sha256=G5x7IlIzWN98TsXpY80M5nyLjXIwBWWeL9Fk6Piwpzw,188776
 azureml/rag/_asset_client/_restclient/runhistory/operations/__init__.py,sha256=FFrjEyJdO53e7YDI8o_8W9BgTTEVt1ZzS8FwwnNp7-g,563
 azureml/rag/_asset_client/_restclient/runhistory/operations/_runs_operations.py,sha256=1nl-ETYrSQSZH3B-a2QXTKIUCx-Hx3XeQPmgAwKSGoA,162796
-azureml/rag/langchain/acs.py,sha256=zC6qLmyvQKvM48bMKC9CBtaiEvGx_TalMUyHE8I-nbc,10785
+azureml/rag/langchain/acs.py,sha256=xyJ5u7RlZ8FUVAQZg7z4LJv5pXACddLcRLihUL6sEQI,10785
 azureml/rag/tasks/__init__.py,sha256=JlCCObuOLZyNhIZlsoL51KtFxiY4xKIIzIRDBcdeu6Y,183
 azureml/rag/tasks/build_faiss.py,sha256=dXETVJJT77PGrav6OiUBzve5EjqOutNcD5cpP1vIHxU,2094
-azureml/rag/tasks/crack_and_chunk.py,sha256=V-aqVaGvJx9Gp80A6K0sQZvdOij9yiwwPv04VZNajD4,7191
+azureml/rag/tasks/crack_and_chunk.py,sha256=uK4Q1eU2OgDI2ey9snpFT3xdpHRz11bdU4IhSDhoJyI,7190
 azureml/rag/tasks/embed.py,sha256=yr_PnSq1a-BLh7EX7TvIVeusk2iD4Udw-xXlvpiCCI0,7330
 azureml/rag/tasks/embed_prs.py,sha256=PmtPLaopfPhW2RC1EIQRuHzEAj-jJFIGZie3psQIcR8,5410
 azureml/rag/tasks/git_clone.py,sha256=Y_f4EiPLG000asZWsYMvhheLPHsKJHsXyvmHyGiEoPA,2194
 azureml/rag/tasks/register_mlindex.py,sha256=4T7UEav88naHA-bzKWija8pdAwOlRV2kAWmVXyJXi6A,2791
-azureml/rag/tasks/update_acs.py,sha256=Rf15hg17COV3BwFlOPvCmzhMigXUB_QZQ6Wo2NQMpw4,17073
+azureml/rag/tasks/update_acs.py,sha256=3J2_qZJIiRhKQ4As-BzHOmSeL0mQHP9wce1f6PROXl4,17977
 azureml/rag/utils/__init__.py,sha256=FTY5BaTKeythd7R1SXsf3midWHdshZj-bdFZLmZ7J50,208
 azureml/rag/utils/azureml.py,sha256=dOfvDTgqjTWHg-I9Ho7_o6e7I8kNcVJdl53O0Ts7xQs,1588
 azureml/rag/utils/connections.py,sha256=zInLr6twjfHW4fF2zgChtNSI7YqnxY3eOVnu74xpq-Y,7435
 azureml/rag/utils/git.py,sha256=C_79CuCdBNLrid1eUf2nruPynpIgghbf9d9ArnpI_Wc,2350
 azureml/rag/utils/logging.py,sha256=fusY7czHGANkXnZdtdKc9TQjaeH-dSsC0Vts5xWQbfQ,2330
-azureml_rag-0.1.3.dist-info/LICENSE.txt,sha256=FOfkEEz4uS7g278F9Rq12rqKF3lLyBUZhVpLetuZrTg,1021
-azureml_rag-0.1.3.dist-info/METADATA,sha256=Ie90rTL7DikTHl7kJW_gkKatFnh5zxz_JV0_k9GrakM,3482
-azureml_rag-0.1.3.dist-info/WHEEL,sha256=YUYzQ6UQdoqxXjimOitTqynltBCkwY6qlTfTh2IzqQU,97
-azureml_rag-0.1.3.dist-info/top_level.txt,sha256=ZOeEa0TAXo6i5wOjwBoqfIGEuxOcKuscGgNSpizqREY,8
-azureml_rag-0.1.3.dist-info/RECORD,,
+azureml_rag-0.1.4.dist-info/LICENSE.txt,sha256=FOfkEEz4uS7g278F9Rq12rqKF3lLyBUZhVpLetuZrTg,1021
+azureml_rag-0.1.4.dist-info/METADATA,sha256=kVg8gHPh6OqzGQ29HanvTIHB5Pd_vIaZI8Jiq_s3iJU,4968
+azureml_rag-0.1.4.dist-info/WHEEL,sha256=YUYzQ6UQdoqxXjimOitTqynltBCkwY6qlTfTh2IzqQU,97
+azureml_rag-0.1.4.dist-info/top_level.txt,sha256=ZOeEa0TAXo6i5wOjwBoqfIGEuxOcKuscGgNSpizqREY,8
+azureml_rag-0.1.4.dist-info/RECORD,,
```

